<!DOCTYPE html><html lang="en"><head>    <link rel="stylesheet" href="bootstrap.min.css"/>     <meta charset="UTF-8">    <title>RC Car</title>    <style>        * {            font-family: Roboto, Arial, sans-serif;            color: #d2d3d7        }        body {            background-color: #313445;        }        .main_block {            display: block;            text-align: center;            margin: 0 auto;            box-shadow: 0 0 40px #232430;            padding: 20px 40px 80px;            width: 60%;            transition: ease-in-out 1s;            position: relative;        }        .control_buttons {            margin: 0.2em;            font-size: 2em;            width: 2em;            height: 2em;            border-radius: 10px;            border: black solid 1px;        }        .control_buttons:hover {            background-color: #f06952;            box-shadow: 0 0 10px #f06952;            border-radius: 10px;        }        i {            border: solid #d2d3d7;;            border-width: 0 3px 3px 0;            display: inline-block;            padding: 3px;        }        #rotate90        {            transform: rotate(90deg);            -webkit-transform: rotate(90deg);            border: 1px white solid;            margin: 0.8em;            width: 90%;            height: 72%;            padding: 5px;            z-index: 3;        }        .right {            transform: rotate(-45deg);            -webkit-transform: rotate(-45deg);        }        .left {            transform: rotate(135deg);            -webkit-transform: rotate(135deg);        }        .up {            transform: rotate(-135deg);            -webkit-transform: rotate(-135deg);        }        .down {            transform: rotate(45deg);            -webkit-transform: rotate(45deg);        }        canvas {            width: 100%;            height: auto;        }    </style>    <script type="application/javascript">        function $(param){return document.getElementById(param)}        const kp = 2, ki = 5, kd = 1, con = 1, timerupdate = 50,c_timerupdate=500;        let currentTime, previousTime, elapsedTime, error, lastError, input, output, setPoint, cumError, rateError,s_flag=true,            dist_sensor = 0,psteering=-9999,pspeed=-99999;        let speed = 0, steering = 0;        let flagup, flagdown, flagleft, flagright;        let canvas, ctx,image,lastCalledTime,fps;        document.onreadystatechange = () => {            if (document.readyState === 'complete') {               /* canvas = $('myCanvas');                ctx = canvas.getContext('2d');*/                setPoint = 0;                steering = 0;                speed = 0;                flagup = false;                flagdown = false;                flagleft = false;                flagright = false;                ctx.fillStyle = '#d2d3d7';                ctx.textAlign = 'center';                //setInterval(drawing, timerupdate);            }        };        window.setInterval(loadDoc, timerupdate);        window.setInterval(loadDoc2, c_timerupdate);        window.addEventListener('keydown', keyDownHandler);        window.addEventListener('keyup', keyupHandler);        function keyDownHandler(event) {            console.log(event);            let keyPressed = String.fromCharCode(event.keyCode);            if (keyPressed === 'W' || event.keyCode === 38) flagup = true;            else if (keyPressed === 'D' || event.keyCode === 39) flagright = true;            else if (keyPressed === 'S' || event.keyCode === 40) flagdown = true;            else if (keyPressed === 'A' || event.keyCode === 37) flagleft = true;        }        function touchingHandler(inp) {            if (inp === 'U') flagup = true;            else if (inp === 'R') flagright = true;            else if (inp === 'D') flagdown = true;            else if (inp === 'L') flagleft = true;        }        function moving() {            if (flagup&&speed<27) speed += 3;            else if (flagdown&&speed>-27) speed -= 3;            if (flagleft&&steering>-3) steering -= 2;            else if (flagright&&steering<3) steering += 2;            if (steering > 0) steering -= 1;            else if (steering < 0) steering += 1;            if (speed > 0) speed -= 1;            else if (speed < 0) speed += 1;        }        function keyupHandler(event) {            flagup = false;            flagright = false;            flagdown = false;            flagleft = false;        }        function loadDoc() {            console.log("loaddoc");            let flag = false;            let xhttp = new XMLHttpRequest();            var string_array = '';            let array = [];            xhttp.onreadystatechange = function () {                if (this.readyState === 4 && this.status === 200) flag = true;                string_array = this.responseText;                s_flag=true;                array = JSON.parse(string_array);                $("distance_cm").textContent=array["distance"];            };            if((pspeed!=speed || psteering!=steering)&&s_flag) {                xhttp.open(`GET`, 'http://192.168.1.1/moving?steering=' + steering + '&speed=' + speed+ 't='+Date.now(), true);                xhttp.send();                psteering=steering;                pspeed=speed;                s_flag=false;            }            moving();        }        function loadDoc2() {            console.log("loaddoc2");            let flag = false;            let xhttp = new XMLHttpRequest();            var string_array = '';            let array = [];            xhttp.onreadystatechange = function () {                if (this.readyState === 4 && this.status === 200) flag = true;                string_array = this.responseText;                array = JSON.parse(string_array);                $("distance_cm").textContent=array["distance"];                s_flag=true;            };                if(s_flag) {                    xhttp.open(`GET`, 'http://192.168.1.1/moving?'+'t='+Date.now(), true);                    xhttp.send();                s_flag=false;                }            moving();        }      /*  function drawing() {            image=new Image(800,600);            image.onload=function()            {                ctx.clearRect(0, 0, canvas.width, canvas.height);                ctx.drawImage(image, 0, 0,canvas.width,canvas.height);            };            image.src="http://192.168.1.200/capture";            ctx.font = `30px Arial sans-serif`;            ctx.textAlign = 'center';            ctx.fillText(`Kicsi Kocsi`, (canvas.width / 2) + (steering - 0), canvas.height / 2 + (-speed));            ctx.font = `15px Arial sans-serif`;            ctx.textAlign = 'left';            ctx.fillText(`Dist:` + dist_sensor  +` cm`, (canvas.width - 100), 20);            if(!lastCalledTime) {                lastCalledTime = Date.now();                fps = 0;                return;            }            delta = (Date.now() - lastCalledTime)/1000;            lastCalledTime = Date.now();            fps = 1/delta;            ctx.fillText(`FPS:` +fps.toFixed(0), (30),canvas.height-20);        }*/        $("left-button").addEventListener("ontouchend",()=>{touchingHandler('L')});        $("right-button").addEventListener("ontouchend",()=>{touchingHandler('R')});        $("acc-button").addEventListener("ontouchend",()=>{touchingHandler('U')});        $("reverse-button").addEventListener("ontouchend",()=>{touchingHandler('D')});        $("left-button").addEventListener("ontouchend",keyupHandler);        $("right-button").addEventListener("ontouchend",keyupHandler);        $("acc-button").addEventListener("ontouchend",keyupHandler);        $("reverse-button").addEventListener("ontouchend",keyupHandler);</script></head><body><h1 class="text-white">RC kocsi</h1><div class="container main_block">    <div class="row">    <div class="col-md-9">        <p><img id="rotate90"  alt="Stream" src="http://192.168.1.200:81/stream"/></p>    </div>    </div>    <div id="left-button" class="control_buttons" onmousedown="touchingHandler('L')" onmouseup="keyupHandler()" style=" float:left;"><i class="left"></i></div>    <div id="right-button" class="control_buttons" onmousedown="touchingHandler('R')" onmouseup="keyupHandler()" style=" float:left;"><i class="right"></i></div>    <div id="acc-button" class="control_buttons" onmousedown="touchingHandler('U')" onmouseup="keyupHandler()" style=" float:right;"><i class="up"></i></div><div id="reverse-button" class="control_buttons" onmousedown="touchingHandler('D')" onmouseup="keyupHandler()" style=" float:right;"><i class="down"></i></div></div><p>Distance: <span id="distance_cm">000</span> cm</p></body></html>